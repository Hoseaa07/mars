{% extends 'base.html' %}
{% block content %}
<div class="grid gap-6 lg:grid-cols-[minmax(0,1.6fr)_minmax(0,1.2fr)]">
  <section class="bg-white/90 dark:bg-slate-900/90 border border-slate-200 dark:border-slate-800 rounded-3xl p-5 sm:p-6 shadow-lg shadow-slate-200/80 dark:shadow-black/40">
    <h1 class="text-xl sm:text-2xl font-semibold">Wallet</h1>

    {% if current %}
      <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
        Ini adalah wallet utama yang terhubung dengan akun
        <span class="font-mono text-emerald-700 dark:text-emerald-300">{{ current.username }}</span>.
        Seed disimpan terenkripsi di server, tapi tetap ditampilkan di bawah supaya bisa kamu backup.
      </p>

      <div class="mt-4 space-y-3">
        <div class="rounded-2xl border border-emerald-300 dark:border-emerald-500/60 bg-emerald-50/80 dark:bg-emerald-500/10 p-3">
          <div class="text-[11px] uppercase text-emerald-900 dark:text-emerald-200">Address utama</div>
          <pre class="mt-1 text-[11px] font-mono break-all text-emerald-900 dark:text-emerald-50">{{ current.address }}</pre>
        </div>
        <div class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-950/80 p-3">
          <div class="text-[11px] uppercase text-slate-500 dark:text-slate-400">Seed phrase (jangan dibagikan)</div>
          <pre class="mt-1 text-[11px] font-mono break-words whitespace-pre-wrap text-slate-800 dark:text-slate-100">{{ current.seed }}</pre>
        </div>
        <div class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-950/80 p-3">
          <div class="text-[11px] uppercase text-slate-500 dark:text-slate-400">Saldo</div>
          <div class="mt-1 text-xl font-semibold">
            {{ '%.8f'|format(logged_balance or 0.0) }} <span class="text-sm text-emerald-600 dark:text-emerald-300">MARS</span>
          </div>
        </div>
      </div>
    {% else %}
      <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
        Kamu belum login akun. Kamu tetap bisa membuat wallet manual pakai seed phrase sendiri
        (mirip cold wallet) tanpa disimpan di server.
      </p>
    {% endif %}

    <hr class="my-5 border-slate-200 dark:border-slate-800">

    <h2 class="text-sm font-semibold">Mode manual (tanpa akun)</h2>
    <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
      Cocok kalau kamu pengen pegang seed sendiri 100% tanpa disimpan di server.
    </p>

    <div class="mt-3 grid gap-5 md:grid-cols-2">
      <div>
        <h3 class="text-xs font-semibold text-slate-700 dark:text-slate-300">Create wallet manual</h3>
        <form method="post" class="mt-2 space-y-3">
          <input type="hidden" name="mode" value="manual">
          <input type="hidden" name="action" value="create">
          <button class="px-4 py-2.5 rounded-full bg-mars-500 hover:bg-mars-400 text-xs font-medium text-white shadow-lg shadow-mars-500/40">
            Generate seed & address
          </button>
        </form>
      </div>
      <div>
        <h3 class="text-xs font-semibold text-slate-700 dark:text-slate-300">Restore wallet manual</h3>
        <form method="post" class="mt-2 space-y-3">
          <input type="hidden" name="mode" value="manual">
          <input type="hidden" name="action" value="restore">
          <label class="block text-xs text-slate-500 dark:text-slate-400 mb-1">Seed phrase</label>
          <textarea name="seed_phrase" rows="3" class="w-full px-3 py-2.5 text-xs rounded-2xl bg-slate-50 dark:bg-slate-950/70 border border-slate-200 dark:border-slate-800 focus:outline-none focus:border-mars-400 focus:ring-1 focus:ring-mars-400"></textarea>
          <button class="px-4 py-2.5 rounded-full bg-slate-900 text-slate-50 dark:bg-slate-200 dark:text-slate-900 text-xs font-medium">
            Restore wallet
          </button>
        </form>
      </div>
    </div>

    {% if message %}
    <div class="mt-4 text-xs rounded-2xl px-3 py-2.5 bg-rose-500/10 border border-rose-500/80 text-rose-700 dark:text-rose-100">
      {{ message }}
    </div>
    {% endif %}

    {% if manual_created %}
    <div class="mt-5 space-y-3">
      <div class="rounded-2xl border border-mars-400/80 bg-mars-50/80 dark:border-mars-500/60 dark:bg-mars-500/10 p-3">
        <div class="text-[11px] uppercase text-slate-700 dark:text-slate-200">Seed Phrase (manual)</div>
        <pre class="mt-1 text-[11px] font-mono break-words whitespace-pre-wrap text-slate-900 dark:text-slate-50">{{ manual_created.seed }}</pre>
      </div>
      <div class="rounded-2xl border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-950/70 p-3">
        <div class="text-[11px] uppercase text-slate-500 dark:text-slate-400">Address</div>
        <pre class="mt-1 text-[11px] font-mono break-all text-slate-800 dark:text-slate-100">{{ manual_created.address }}</pre>
      </div>
    </div>
    {% endif %}

    {% if manual_restored %}
    <div class="mt-5 space-y-3">
      <div class="rounded-2xl border border-emerald-400/80 bg-emerald-50/80 dark:border-emerald-500/60 dark:bg-emerald-500/10 p-3">
        <div class="text-[11px] uppercase text-slate-700 dark:text-slate-200">Wallet restored (manual)</div>
        <pre class="mt-1 text-[11px] font-mono break-all text-slate-900 dark:text-slate-50">{{ manual_restored.address }}</pre>
      </div>
    </div>
    {% endif %}
  </section>

  <section class="bg-white/90 dark:bg-slate-900/90 border border-slate-200 dark:border-slate-800 rounded-3xl p-5 sm:p-6 shadow-lg shadow-slate-200/80 dark:shadow-black/40 flex flex-col justify-between gap-4">
    <div>
      <h2 class="text-lg font-semibold">Cek saldo address</h2>
      <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
        Bisa cek saldo address mana pun di chain lokal node ini.
      </p>

      <form method="get" class="mt-4 space-y-3">
        <label class="text-xs text-slate-500 dark:text-slate-400">Address</label>
        <input name="address" value="{{ query_address or '' }}" class="w-full px-3 py-2.5 text-xs rounded-2xl bg-slate-50 dark:bg-slate-950/70 border border-slate-200 dark:border-slate-800 focus:outline-none focus:border-mars-400 focus:ring-1 focus:ring-mars-400" placeholder="MARS...">
        <button class="px-4 py-2.5 rounded-full bg-slate-900 text-slate-50 dark:bg-slate-200 dark:text-slate-900 text-xs font-medium">
          Check balance
        </button>
      </form>

      {% if query_balance is not none %}
      <div class="mt-4 rounded-2xl border border-emerald-300 dark:border-emerald-500/60 bg-emerald-50/80 dark:bg-emerald-500/10 p-4">
        <div class="text-xs text-emerald-900 dark:text-emerald-200">Saldo address</div>
        <div class="mt-1 text-2xl font-semibold text-emerald-900 dark:text-emerald-100">{{ '%.8f'|format(query_balance) }} <span class="text-sm text-emerald-700 dark:text-emerald-300">MARS</span></div>
      </div>
      {% endif %}
    </div>

    <p class="text-[11px] text-slate-500 dark:text-slate-500">
      Saldo dihitung ulang dari seluruh transaksi di chain lokal node ini.
    </p>
  </section>
</div>
{% endblock %}
